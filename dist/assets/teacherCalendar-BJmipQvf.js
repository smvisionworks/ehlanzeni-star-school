import{a as E,d}from"./firebase-B3bAttLw.js";import{onAuthStateChanged as w,signOut as B}from"https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";import{ref as u,get as v,onValue as L,push as T,set as y}from"https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";import"./global-floating-logout-Em6X96d7.js";import"https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";import"https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js";let m=null,l=null;document.addEventListener("DOMContentLoaded",()=>{w(E,async e=>{if(!e){o("Please log in to access this page","error"),setTimeout(()=>window.location.href="../landing/login.html",3e3);return}m=e,await $(e.uid),await k()})});async function $(e){try{const t=u(d,`teachers/${e}`),n=await v(t);return n.exists()?(l=n.val(),l.status==="pending"?(o("Your teacher account is pending admin approval. You will be notified once approved.","error"),setTimeout(()=>window.location.href="../landing/login.html",3e3),!1):!0):(o("Teacher profile not found","error"),setTimeout(()=>window.location.href="../landing/login.html",3e3),!1)}catch(t){return console.error("Error checking teacher status:",t),o("Error verifying teacher status","error"),!1}}async function k(){if(!l)return;const e=`${l.personalInfo.firstName} ${l.personalInfo.lastName}`;document.getElementById("teacherName").textContent=e,await D(),await N(),b()}async function D(){try{const e=u(d,"courses"),t=await v(e),n=document.getElementById("courseId");if(n.innerHTML='<option value="">Select a Course</option>',t.exists()){const a=t.val();Object.entries(a).forEach(([i,r])=>{if(r.teacherId===m.uid&&r.status==="active"){const s=document.createElement("option");s.value=i,s.textContent=`${r.name} (${r.code})`,n.appendChild(s)}})}}catch(e){console.error("Error loading courses:",e),o("Error loading courses","error")}}async function N(){const e=document.getElementById("loading"),t=document.getElementById("eventsList");try{const n=u(d,`calendar_events/${m.uid}`);L(n,a=>{if(t.innerHTML="",a.exists()){const i=a.val(),r=[];Object.entries(i).forEach(([s,c])=>{new Date(c.date)>=new Date&&r.push({id:s,...c})}),r.sort((s,c)=>new Date(s.date)-new Date(c.date)),r.length===0?t.innerHTML='<div class="no-events">No upcoming classes scheduled</div>':r.forEach(s=>{const c=C(s);t.appendChild(c)})}else t.innerHTML='<div class="no-events">No classes scheduled yet</div>';e.style.display="none"})}catch(n){console.error("Error loading events:",n),o("Error loading events","error"),e.style.display="none"}}function C(e){const t=document.createElement("div");return t.className="event-card",t.innerHTML=`
    <h4>${e.title}</h4>
    <p><strong>Date:</strong> ${new Date(e.date).toLocaleDateString()}</p>
    <p class="time"><strong>Time:</strong> ${e.startTime} - ${e.endTime}</p>
    <p><strong>Course:</strong> ${e.courseName||e.courseId}</p>
    <p><strong>Notes:</strong> ${e.notes}</p>
    ${e.joinLink?`<p><strong>Join Link:</strong> <a href="${e.joinLink}" target="_blank">${e.joinLink}</a></p>`:""}
    <button class="delete-btn" onclick="deleteEvent('${e.id}')">Delete</button>
  `,t}async function S(e){if(confirm("Are you sure you want to delete this event?"))try{const t=u(d,`calendar_events/${m.uid}/${e}`);await y(t,null),o("Event deleted successfully","success")}catch(t){console.error("Error deleting event:",t),o("Error deleting event","error")}}function b(){document.getElementById("addEventBtn").addEventListener("click",j);const t=document.getElementById("logoutModal"),n=document.getElementById("confirmLogout"),a=document.getElementById("cancelLogout");document.getElementById("logoutBtn").addEventListener("click",()=>t.style.display="flex"),a.addEventListener("click",()=>t.style.display="none"),n.addEventListener("click",x)}async function j(){const e=document.getElementById("title").value,t=document.getElementById("date").value,n=document.getElementById("startTime").value,a=document.getElementById("endTime").value,i=document.getElementById("notes").value,r=document.getElementById("courseId").value,s=document.getElementById("joinLink").value;if(!e||!t||!n||!a||!r){o("Please fill in all required fields","error");return}const c=u(d,`courses/${r}`),g=await v(c);if(!g.exists()){o("Selected course not found","error");return}const h=g.val(),p={title:e,date:t,startTime:n,endTime:a,notes:i,courseId:r,courseName:h.name,joinLink:s,teacherId:m.uid,teacherName:`${l.personalInfo.firstName} ${l.personalInfo.lastName}`,createdAt:new Date().toISOString()};try{const f=u(d,`calendar_events/${m.uid}`),I=T(f);await y(I,p),o("Class event added successfully","success"),document.getElementById("title").value="",document.getElementById("date").value="",document.getElementById("startTime").value="",document.getElementById("endTime").value="",document.getElementById("notes").value="",document.getElementById("joinLink").value=""}catch(f){console.error("Error adding event:",f),o("Error adding event","error")}}async function x(){try{await B(E),o("Logged out successfully!","success"),setTimeout(()=>window.location.href="../landing/login.html",1e3)}catch(e){console.error("Logout error:",e),o("Failed to logout: "+e.message,"error")}}function o(e,t="success"){const n=document.getElementById("toast");n.textContent=e,n.className=`toast ${t} show`,setTimeout(()=>n.className="toast",3e3)}window.deleteEvent=S;
