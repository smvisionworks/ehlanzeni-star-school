import{a as y,d as u}from"./firebase-B3bAttLw.js";import{onAuthStateChanged as w}from"https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";import{ref as d,get as g,set as C}from"https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";import"./global-floating-logout-Em6X96d7.js";import"https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";import"https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js";let h=null,o=null;document.addEventListener("DOMContentLoaded",()=>{w(y,async t=>{if(!t){r("Please log in to access this page","error"),setTimeout(()=>window.location.href="../landing/login.html",3e3);return}h=t,await b(t.uid),await v()})});async function b(t){try{const s=d(u,`application/pending/${t}`),n=await g(s);if(n.exists()){const e=n.val();return e.status==="approved"&&e.payment&&e.payment.registrationFee==="paid"?e.monthlyPayment&&e.monthlyPayment.status==="pending"?(console.log("Monthly payment pending for month:",e.monthlyPayment.month),window.location.href="../students/payment-pending.html",!1):(o=e,!0):(r("Your application is not yet fully approved","error"),setTimeout(()=>window.location.href="../unverifiedstudents/student-dashboard.html",3e3),!1)}return r("No complete application found","error"),setTimeout(()=>window.location.href="../landing/login.html",3e3),!1}catch(s){return console.error("Error checking user status:",s),r("Error verifying application status","error"),!1}}async function v(){if(!o){console.error("No user data available");return}const t=`${o.firstName} ${o.lastName}`;document.getElementById("studentName").textContent=t,await E(h.uid)}async function E(t){const s=document.getElementById("loading"),n=document.getElementById("coursesContainer");s.style.display="flex",n.innerHTML="";try{const e=o.subjects||[];if(e.length===0){n.innerHTML='<p style="color: #555; font-size: 1.2rem; text-align: center;">No subjects registered in your application.</p>',s.style.display="none";return}const a=d(u,"courses"),c=await g(a);if(!c.exists()){p(e),s.style.display="none";return}const f=c.val(),i=Object.entries(f).filter(([m,l])=>e.includes(l.name)||e.includes(l.subject)).map(([m,l])=>({id:m,...l}));await $(t,i),i.length===0?p(e,!0):S(i)}catch(e){console.error("Error fetching courses:",e),r("Failed to load courses: "+e.message,"error"),n.innerHTML='<p style="color: #555; font-size: 1.2rem; text-align: center;">Error loading courses. Please try again later.</p>'}finally{s.style.display="none"}}async function $(t,s){try{const n=d(u,`enrollments/${t}`);for(const e of s){const a={courseId:e.id,courseName:e.name,enrolledAt:new Date().toISOString(),status:"active",studentName:`${o.firstName} ${o.lastName}`,studentId:t};await C(d(u,`enrollments/${t}/${e.id}`),a)}console.log("Enrollments created for student:",t)}catch(n){console.error("Error creating enrollments:",n)}}function S(t){const s=document.getElementById("coursesContainer");s.innerHTML="",t.forEach(n=>{const e=document.createElement("div");e.className="course-card",e.innerHTML=`
            <i class="fas fa-book-open course-icon"></i>
            <h3>${n.name}</h3>
            <p class="course-description">${n.description||"Course description not available"}</p>
            <div class="course-meta">
                <span class="course-code">Code: ${n.code||"N/A"}</span>
                <span class="course-status enrolled">Enrolled</span>
            </div>
            <div class="course-teacher">
                <i class="fas fa-chalkboard-teacher"></i>
                Teacher: ${n.teacherName||"Not assigned"}
            </div>
            <button onclick="window.location.href='resources.html?course=${n.id}'" class="enrolled-overlay">
                View Course Resources <i class="fas fa-arrow-right"></i>
            </button>
        `,s.appendChild(e)})}function p(t,s=!1){const n=document.getElementById("coursesContainer");n.innerHTML="",t.forEach(e=>{if(e==="N/A")return;const a=document.createElement("div");a.className=`course-card ${s?"pending":""}`;const c=N(e),f=s?"Pending Enrollment":"Registered",i=s?"pending":"registered";a.innerHTML=`
            <i class="${c} course-icon"></i>
            <h3>${e}</h3>
            <p class="course-description">${M(e)}</p>
            <div class="course-meta">
                <span class="course-status ${i}">${f}</span>
            </div>
            ${s?'<div class="pending-message"><i class="fas fa-clock"></i> Course setup in progress</div>':`<button class="enrolled-overlay" onclick="showSubjectResources('${e}')">
                    View Subject Materials <i class="fas fa-arrow-right"></i>
                </button>`}
        `,n.appendChild(a)})}function N(t){return{English:"fas fa-language",Afrikaans:"fas fa-language",IsiZulu:"fas fa-language",Mathematics:"fas fa-calculator","Mathematical Literacy":"fas fa-chart-bar","Physical Sciences":"fas fa-atom",Chemistry:"fas fa-flask","Life Sciences":"fas fa-dna",Geography:"fas fa-globe-africa",History:"fas fa-monument",Economics:"fas fa-chart-line",Accounting:"fas fa-calculator","Business Studies":"fas fa-briefcase","Computer Applications Technology":"fas fa-laptop"}[t]||"fas fa-book"}function M(t){return{English:"Language and literature studies",Mathematics:"Advanced mathematical concepts and problem solving","Physical Sciences":"Physics and chemistry fundamentals","Life Sciences":"Biology and life processes",Accounting:"Financial accounting principles","Business Studies":"Business management and entrepreneurship"}[t]||"Academic subject"}function T(t){r(`Resources for ${t} will be available soon`,"info")}function r(t,s="success"){const n=document.getElementById("toast");n.textContent=t,n.className=`toast ${s} show`,setTimeout(()=>n.className=`toast ${s}`,3e3)}window.showSubjectResources=T;
